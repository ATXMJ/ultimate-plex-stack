**Navigation:** [← Previous: Step 10 – Configuration Automation (Buildarr)](10-buildarr-automation.md) | [Next: Step 11 – Media Management (The \"Arrs\") →](11-media-management.md)

# Step 10.1: Arr Configuration-as-Code (Buildarr)

**Status:** `PLANNED`

This document details how to fully express the Arr ecosystem (Prowlarr, Radarr, Sonarr, and optionally Bazarr) configuration in `buildarr.yml`, and how to apply/verify those settings using the Buildarr container introduced in Step 10.

**Design Decision:** `buildarr.yml` is the **source of truth** for Arr configuration. The Arr / Prowlarr web UIs are for **verification and diagnostics only**. If you make a one-off change in a UI, you should reflect it back into `buildarr.yml` and re‑apply Buildarr rather than relying on the UI change long-term.

**Agent Instructions:** Prefer editing `buildarr.yml` and running Buildarr over clicking through the Radarr/Sonarr/Prowlarr UIs. Always warn before applying Buildarr that it may overwrite existing manual configuration in those services.

## Objectives

- Model Prowlarr authentication, indexers, and Arr Apps in `buildarr.yml`.
- Model Radarr/Sonarr root folders, quality profiles, and download clients in `buildarr.yml`.
- Optionally model Bazarr subtitle settings when/if supported.
- Run Buildarr against live services and verify that UIs match the YAML.
- Update documentation to reflect Buildarr-driven Arr configuration.

## Detailed Implementation Steps

1.  **Extend Prowlarr Configuration in `buildarr.yml`** [PLANNED][PROMPT_USER]  
    *   Ensure the `prowlarr:` block defines:
        *   Authentication method and credentials (if you enabled auth in Step 9).
        *   All desired indexers (public and/or private), including categories and tags.
        *   Application integrations (Apps) for Radarr and Sonarr.
    *   Use the Prowlarr UI from Step 9 as a reference for the desired end state, but **treat `buildarr.yml` as canonical**.
    *   After editing `buildarr.yml`, plan to run Buildarr as described in Step 5 of this document.
    *   Update the status of this sub-step to `[COMPLETE]` once Prowlarr state is fully represented in YAML.

2.  **Add Radarr/Sonarr/Bazarr Sections** [PLANNED][PROMPT_USER]  
    *   Add sections in `buildarr.yml` for:
        *   `radarr:` – movie root folders, quality profiles, download clients.
        *   `sonarr:` – TV root folders, quality profiles, download clients.
        *   `bazarr:` – subtitle settings (if/when supported and desired).
    *   **Path Convention:**
        *   Inside containers, Radarr/Sonarr see:
            *   Movies root folder: `/movies`
            *   TV root folder: `/tv`
        *   On the host, these paths are backed by environment variables such as:
            *   `MOVIES_PATH` → maps to `/movies`
            *   `TV_PATH` → maps to `/tv`
        *   **Do not change** the internal container paths (`/movies`, `/tv`) even after NAS migration – only the host side (`MOVIES_PATH`, `TV_PATH`) will change in Step 16.
    *   Configure at minimum:
        *   One movie quality profile and one TV quality profile that match your baseline preferences.
        *   Download clients pointing at `qbittorrent:8080` (and/or NZBGet) with credentials from Step 8.
    *   Update the status of this sub-step to `[COMPLETE]` once these sections exist and are syntactically valid.

3.  **Define Prowlarr Apps for Radarr/Sonarr** [PLANNED][PROMPT_USER]  
    *   In the `prowlarr:` section of `buildarr.yml`, define Apps for:
        *   Radarr: `http://radarr:7878` with the API key obtained from Radarr.
        *   Sonarr: `http://sonarr:8989` with the API key obtained from Sonarr.
    *   Ensure indexers are attached to these Apps as desired so they propagate from Prowlarr to Radarr/Sonarr.
    *   Plan to re‑run Buildarr after any changes to app definitions.
    *   Update the status of this sub-step to `[COMPLETE]` once Apps are defined and validated.

4.  **Apply Buildarr Configuration to Arr Services** [PLANNED]  
    *   Prerequisites:
        *   Prowlarr is running from Step 9.
        *   Radarr/Sonarr/Bazarr containers are deployed from Step 11.
    *   **Warning:** Buildarr may overwrite existing manual settings in Prowlarr/Radarr/Sonarr/Bazarr. Ensure you are comfortable with `buildarr.yml` representing the desired end state before proceeding.
    *   From the project root, run:
        ```powershell
        docker compose run --rm buildarr apply
        ```
    *   Verify that:
        *   Prowlarr authentication, indexers, and Apps match `buildarr.yml`.
        *   Radarr/Sonarr show the expected root folders, quality profiles, and download clients.
        *   (If configured) Bazarr reflects the subtitle settings from `buildarr.yml`.
    *   If anything is incorrect, **fix it in `buildarr.yml` and re-run Buildarr**, rather than relying on UI tweaks.
    *   Update the status of this sub-step to `[COMPLETE]` once the configuration applies cleanly.

5.  **Update Documentation for Buildarr-Driven Arr Configuration** [PLANNED]  
    *   Once the above configuration steps are `[COMPLETE]`:
    *   Update `docs/Configuration.md` to:
        *   Emphasize `buildarr.yml` as the primary configuration path for Prowlarr/Radarr/Sonarr.
        *   Document the `docker compose run --rm buildarr apply` workflow for Arr-related changes.
    *   Update `docs/Services.md` to:
        *   Note that Arr service configuration (roots, profiles, clients, indexers) is managed via Buildarr where possible.
    *   Update `docs/Deployment.md` to:
        *   Prefer Buildarr (`buildarr.yml` + apply) over manual UI configuration for Arr services.
        *   Reframe Arr/Prowlarr UIs as verification/diagnostic tools.
    *   Update the status of this sub-step to `[COMPLETE]`.

6.  **Mark Step as Complete** [PLANNED]  
    *   Once all preceding steps in this document are `[COMPLETE]`:
    *   Update the status at the top of this file to `COMPLETE`.
    *   Update `plans/setup/00-SETUP.md` to mark Step 10.1 as `[COMPLETE]`.
    *   Update the status of this sub-step to `[COMPLETE]`.


